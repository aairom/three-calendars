<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Three Calendar System</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    min-height: 100vh;
    padding: 20px;
    color: #e0e0e0;
  }

  h1 {
    text-align: center;
    font-size: 1.8rem;
    margin-bottom: 24px;
    color: #e0e0e0;
    letter-spacing: 1px;
    text-shadow: 0 2px 8px rgba(0,0,0,0.5);
  }

  .calendars-wrapper {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
    max-width: 1300px;
    margin: 0 auto;
  }

  .calendar-card {
    background: rgba(255,255,255,0.07);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 16px;
    padding: 20px;
    width: 380px;
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    transition: transform 0.2s;
  }
  .calendar-card:hover { transform: translateY(-2px); }

  .calendar-card.gregorian { border-top: 3px solid #4fc3f7; }
  .calendar-card.persian   { border-top: 3px solid #81c784; }
  .calendar-card.hijri     { border-top: 3px solid #ffb74d; }

  .cal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
  }

  .cal-title {
    font-size: 1rem;
    font-weight: 700;
    letter-spacing: 0.5px;
  }
  .gregorian .cal-title { color: #4fc3f7; }
  .persian   .cal-title { color: #81c784; }
  .hijri     .cal-title { color: #ffb74d; }

  .cal-subtitle {
    font-size: 0.75rem;
    color: #aaa;
    margin-top: 2px;
  }

  .nav-btn {
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    color: #e0e0e0;
    border-radius: 8px;
    width: 32px;
    height: 32px;
    cursor: pointer;
    font-size: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
    flex-shrink: 0;
  }
  .nav-btn:hover { background: rgba(255,255,255,0.2); }

  .month-year-display {
    text-align: center;
    flex: 1;
    padding: 0 8px;
  }
  .month-name {
    font-size: 1.05rem;
    font-weight: 600;
    color: #fff;
  }
  .year-num {
    font-size: 0.85rem;
    color: #bbb;
  }

  .cal-grid {
    width: 100%;
    border-collapse: collapse;
  }

  .cal-grid th {
    text-align: center;
    font-size: 0.72rem;
    font-weight: 600;
    color: #aaa;
    padding: 4px 2px 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .cal-grid td {
    text-align: center;
    padding: 3px 2px;
    font-size: 0.85rem;
    cursor: pointer;
    border-radius: 8px;
    transition: background 0.15s, color 0.15s;
    height: 34px;
    width: 14.28%;
  }

  .cal-grid td:hover:not(.empty) {
    background: rgba(255,255,255,0.15);
  }

  .cal-grid td.empty { cursor: default; }

  .cal-grid td.today {
    font-weight: 700;
    color: #fff;
  }
  .gregorian .cal-grid td.today { background: #4fc3f7; color: #0d1b2a; }
  .persian   .cal-grid td.today { background: #81c784; color: #0d1b2a; }
  .hijri     .cal-grid td.today { background: #ffb74d; color: #0d1b2a; }

  .cal-grid td.selected {
    outline: 2px solid rgba(255,255,255,0.6);
    outline-offset: -2px;
    font-weight: 600;
  }

  .cal-grid td.weekend { color: #ef9a9a; }
  .cal-grid td.today.weekend { color: #0d1b2a; }

  /* RTL for Persian and Hijri */
  .persian .cal-grid,
  .hijri   .cal-grid { direction: rtl; }

  /* Input section */
  .input-section {
    margin-top: 16px;
    padding-top: 14px;
    border-top: 1px solid rgba(255,255,255,0.1);
  }

  .input-section label {
    display: block;
    font-size: 0.72rem;
    color: #aaa;
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .input-row {
    display: flex;
    gap: 6px;
    align-items: center;
  }

  .input-row input, .input-row select {
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.2);
    color: #e0e0e0;
    border-radius: 8px;
    padding: 6px 8px;
    font-size: 0.82rem;
    outline: none;
    transition: border-color 0.2s;
  }
  .input-row input:focus, .input-row select:focus {
    border-color: rgba(255,255,255,0.5);
  }
  .input-row input[type=number] { width: 72px; }
  .input-row select { flex: 1; }
  .input-row input[type=number].day-input { width: 56px; }

  .go-btn {
    background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.3);
    color: #fff;
    border-radius: 8px;
    padding: 6px 12px;
    font-size: 0.82rem;
    cursor: pointer;
    transition: background 0.2s;
    white-space: nowrap;
  }
  .go-btn:hover { background: rgba(255,255,255,0.25); }

  .gregorian .go-btn:hover { background: rgba(79,195,247,0.3); }
  .persian   .go-btn:hover { background: rgba(129,199,132,0.3); }
  .hijri     .go-btn:hover { background: rgba(255,183,77,0.3); }

  .input-row select option {
    background: #1a1a2e;
    color: #e0e0e0;
  }

  .today-btn {
    display: block;
    width: 100%;
    margin-top: 8px;
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.15);
    color: #bbb;
    border-radius: 8px;
    padding: 5px;
    font-size: 0.78rem;
    cursor: pointer;
    transition: background 0.2s;
  }
  .today-btn:hover { background: rgba(255,255,255,0.12); color: #fff; }

  .leap-badge {
    display: inline-block;
    font-size: 0.65rem;
    padding: 1px 6px;
    border-radius: 10px;
    margin-left: 6px;
    vertical-align: middle;
    opacity: 0.8;
  }
  .gregorian .leap-badge { background: rgba(79,195,247,0.25); color: #4fc3f7; }
  .persian   .leap-badge { background: rgba(129,199,132,0.25); color: #81c784; }
  .hijri     .leap-badge { background: rgba(255,183,77,0.25); color: #ffb74d; }

  @media (max-width: 820px) {
    .calendar-card { width: 100%; max-width: 420px; }
  }
</style>
</head>
<body>

<h1>ðŸ—“ Three Calendar System</h1>

<div class="calendars-wrapper">
  <!-- Gregorian -->
  <div class="calendar-card gregorian" id="card-greg">
    <div class="cal-header">
      <button class="nav-btn" onclick="navigate('greg',-1)">&#8249;</button>
      <div class="month-year-display">
        <div class="month-name" id="greg-month-name"></div>
        <div class="year-num" id="greg-year-num"></div>
      </div>
      <button class="nav-btn" onclick="navigate('greg',1)">&#8250;</button>
    </div>
    <table class="cal-grid" id="greg-grid"></table>
    <div class="input-section">
      <label>Go to date (Gregorian)</label>
      <div class="input-row">
        <input type="number" id="greg-in-year" placeholder="Year" min="1" max="9999">
        <select id="greg-in-month"></select>
        <input type="number" id="greg-in-day" class="day-input" placeholder="Day" min="1" max="31">
        <button class="go-btn" onclick="goToDate('greg')">Go</button>
      </div>
      <button class="today-btn" onclick="goToToday()">Today</button>
    </div>
  </div>

  <!-- Persian / Jalali -->
  <div class="calendar-card persian" id="card-pers">
    <div class="cal-header">
      <button class="nav-btn" onclick="navigate('pers',-1)">&#8249;</button>
      <div class="month-year-display">
        <div class="month-name" id="pers-month-name"></div>
        <div class="year-num" id="pers-year-num"></div>
      </div>
      <button class="nav-btn" onclick="navigate('pers',1)">&#8250;</button>
    </div>
    <table class="cal-grid" id="pers-grid"></table>
    <div class="input-section">
      <label>Go to date (Persian / Jalali)</label>
      <div class="input-row">
        <input type="number" id="pers-in-year" placeholder="Year" min="1" max="3177">
        <select id="pers-in-month"></select>
        <input type="number" id="pers-in-day" class="day-input" placeholder="Day" min="1" max="31">
        <button class="go-btn" onclick="goToDate('pers')">Go</button>
      </div>
      <button class="today-btn" onclick="goToToday()">Today</button>
    </div>
  </div>

  <!-- Hijri / Islamic -->
  <div class="calendar-card hijri" id="card-hijri">
    <div class="cal-header">
      <button class="nav-btn" onclick="navigate('hijri',-1)">&#8249;</button>
      <div class="month-year-display">
        <div class="month-name" id="hijri-month-name"></div>
        <div class="year-num" id="hijri-year-num"></div>
      </div>
      <button class="nav-btn" onclick="navigate('hijri',1)">&#8250;</button>
    </div>
    <table class="cal-grid" id="hijri-grid"></table>
    <div class="input-section">
      <label>Go to date (Hijri / Islamic)</label>
      <div class="input-row">
        <input type="number" id="hijri-in-year" placeholder="Year" min="1" max="9999">
        <select id="hijri-in-month"></select>
        <input type="number" id="hijri-in-day" class="day-input" placeholder="Day" min="1" max="30">
        <button class="go-btn" onclick="goToDate('hijri')">Go</button>
      </div>
      <button class="today-btn" onclick="goToToday()">Today</button>
    </div>
  </div>
</div>

<script>
// ============================================================
// UTILITY
// ============================================================
function div(a, b) { return Math.floor(a / b); }
function mod(a, b) { return a - b * Math.floor(a / b); }

// ============================================================
// GREGORIAN <-> JDN
// ============================================================
function g2d(gy, gm, gd) {
  if (gm <= 2) { gy -= 1; gm += 12; }
  const A = div(gy, 100);
  const B = 2 - A + div(A, 4);
  return Math.floor(365.25 * (gy + 4716)) + Math.floor(30.6001 * (gm + 1)) + gd + B - 1524;
}
function d2g(jdn) {
  const aa = Math.floor((jdn - 1867216.25) / 36524.25);
  const A = jdn + 1 + aa - div(aa, 4);
  const B = A + 1524;
  const C = Math.floor((B - 122.1) / 365.25);
  const D = Math.floor(365.25 * C);
  const E = Math.floor((B - D) / 30.6001);
  const day = B - D - Math.floor(30.6001 * E);
  const month = (E < 14) ? E - 1 : E - 13;
  const year = (month > 2) ? C - 4716 : C - 4715;
  return { gy: year, gm: month, gd: day };
}
function isLeapGregorian(y) {
  return (y % 4 === 0 && y % 100 !== 0) || (y % 400 === 0);
}
function gregorianMonthLen(y, m) {
  const days = [0, 31, isLeapGregorian(y) ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
  return days[m];
}

// ============================================================
// PERSIAN (JALALI) <-> JDN  â€” jalaali-js algorithm
// ============================================================
function jalCal(jy) {
  const breaks = [-61,9,38,199,426,686,756,818,1111,1181,1210,1635,2060,2097,2192,2262,2324,2394,2456,3178];
  const bl = breaks.length;
  let gy = jy + 621, leapJ = -14, jp = breaks[0], jm, jump, leap, leapG, march, n, i;
  if (jy < jp || jy >= breaks[bl - 1]) throw new Error('Invalid Jalaali year ' + jy);
  for (i = 1; i < bl; i++) {
    jm = breaks[i]; jump = jm - jp;
    if (jy < jm) break;
    leapJ = leapJ + div(jump, 33) * 8 + div(mod(jump, 33), 4);
    jp = jm;
  }
  n = jy - jp;
  leapJ = leapJ + div(n, 33) * 8 + div(mod(n, 33) + 3, 4);
  if (mod(jump, 33) === 4 && jump - n === 4) leapJ += 1;
  leapG = div(gy, 4) - div((div(gy, 100) + 1) * 3, 4) - 150;
  march = 20 + leapJ - leapG;
  if (jump - n < 6) n = n - jump + div(jump + 4, 33) * 33;
  leap = mod(mod(n + 1, 33) - 1, 4);
  if (leap === -1) leap = 4;
  return { leap, gy, march };
}
function j2d(jy, jm, jd) {
  const r = jalCal(jy);
  return g2d(r.gy, 3, r.march) + (jm - 1) * 30 + Math.min(jm - 1, 6) + jd - 1;
}
function d2j(jdn) {
  let gy = d2g(jdn).gy;
  let jy = gy - 622;
  let jdn_start = j2d(jy, 1, 1);
  let jdn_next  = j2d(jy + 1, 1, 1);
  while (jdn >= jdn_next) { jy++; jdn_start = jdn_next; jdn_next = j2d(jy + 1, 1, 1); }
  while (jdn < jdn_start) { jy--; jdn_next = jdn_start; jdn_start = j2d(jy, 1, 1); }
  let j = jdn - jdn_start;
  let jm = 0;
  while (true) { const dm = (jm < 6) ? 31 : 30; if (j < dm) break; j -= dm; jm++; }
  return { jy, jm: jm + 1, jd: j + 1 };
}
function isLeapJalali(jy) { return jalCal(jy).leap === 0; }
function jalaliMonthLen(jy, jm) {
  if (jm <= 6) return 31;
  if (jm <= 11) return 30;
  return isLeapJalali(jy) ? 30 : 29;
}

// ============================================================
// ISLAMIC (TABULAR) <-> JDN
// Epoch: JDN 1948440 (1 Muharram 1 AH)
// Leap years: positions 3,6,8,11,14,17,19,22,25,27,30 in 30-yr cycle
// (consistent with floor((11y+3)/30) formula)
// ============================================================
function i2d(iy, im, id) {
  return 1948440 + (iy - 1) * 354 + div(11 * iy + 3, 30) + 29 * (im - 1) + div(im, 2) + id - 1;
}
function d2i(jdn) {
  let year = div(30 * (jdn - 1948440) + 10646, 10631);
  while (i2d(year + 1, 1, 1) <= jdn) year++;
  while (i2d(year, 1, 1) > jdn) year--;
  let month = 1;
  while (month < 12 && i2d(year, month + 1, 1) <= jdn) month++;
  const day = jdn - i2d(year, month, 1) + 1;
  return { iy: year, im: month, id: day };
}
function isLeapIslamic(iy) {
  return div(11 * iy + 3, 30) > div(11 * (iy - 1) + 3, 30);
}
function islamicMonthLen(iy, im) {
  if (im < 12) return (im % 2 === 1) ? 30 : 29;
  return isLeapIslamic(iy) ? 30 : 29;
}

// ============================================================
// NAMES
// ============================================================
const GREG_MONTHS = ['January','February','March','April','May','June',
                     'July','August','September','October','November','December'];
const GREG_DAYS   = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

const PERS_MONTHS = ['Farvardin','Ordibehesht','Khordad','Tir','Mordad','Shahrivar',
                     'Mehr','Aban','Azar','Dey','Bahman','Esfand'];
// Persian week starts Saturday: Sha, Yek, Do, Se, Cha, Pan, Jom
const PERS_DAYS   = ['Sha','Yek','Do','Se','Cha','Pan','Jom'];

const HIJRI_MONTHS = ['Muharram','Safar','Rabi\' al-Awwal','Rabi\' al-Thani',
                      'Jumada al-Awwal','Jumada al-Thani','Rajab','Sha\'ban',
                      'Ramadan','Shawwal','Dhu al-Qi\'dah','Dhu al-Hijjah'];
// Hijri week starts Sunday (same as Gregorian)
const HIJRI_DAYS  = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

// ============================================================
// STATE
// ============================================================
// currentJDN: the "selected" day (today initially)
// viewJDN: the JDN of the 1st of the currently displayed month for each calendar
let currentJDN;
let viewGreg  = {}; // {y, m}
let viewPers  = {}; // {jy, jm}
let viewHijri = {}; // {iy, im}
let todayJDN;

// ============================================================
// INIT
// ============================================================
function init() {
  const now = new Date();
  const gy = now.getFullYear(), gm = now.getMonth() + 1, gd = now.getDate();
  todayJDN = g2d(gy, gm, gd);
  currentJDN = todayJDN;
  syncViewFromJDN(currentJDN);
  populateMonthSelects();
  renderAll();
}

function syncViewFromJDN(jdn) {
  const g = d2g(jdn);
  viewGreg = { y: g.gy, m: g.gm };
  const p = d2j(jdn);
  viewPers = { jy: p.jy, jm: p.jm };
  const h = d2i(jdn);
  viewHijri = { iy: h.iy, im: h.im };
}

// ============================================================
// NAVIGATION
// ============================================================
function navigate(cal, delta) {
  if (cal === 'greg') {
    viewGreg.m += delta;
    if (viewGreg.m > 12) { viewGreg.m = 1; viewGreg.y++; }
    if (viewGreg.m < 1)  { viewGreg.m = 12; viewGreg.y--; }
  } else if (cal === 'pers') {
    viewPers.jm += delta;
    if (viewPers.jm > 12) { viewPers.jm = 1; viewPers.jy++; }
    if (viewPers.jm < 1)  { viewPers.jm = 12; viewPers.jy--; }
  } else {
    viewHijri.im += delta;
    if (viewHijri.im > 12) { viewHijri.im = 1; viewHijri.iy++; }
    if (viewHijri.im < 1)  { viewHijri.im = 12; viewHijri.iy--; }
  }
  renderAll();
}

// ============================================================
// GO TO DATE
// ============================================================
function goToDate(cal) {
  let jdn;
  if (cal === 'greg') {
    const y = parseInt(document.getElementById('greg-in-year').value);
    const m = parseInt(document.getElementById('greg-in-month').value);
    const d = parseInt(document.getElementById('greg-in-day').value);
    if (!y || !m || !d) return;
    const maxD = gregorianMonthLen(y, m);
    if (d < 1 || d > maxD) { alert('Day out of range (1â€“' + maxD + ')'); return; }
    jdn = g2d(y, m, d);
  } else if (cal === 'pers') {
    const jy = parseInt(document.getElementById('pers-in-year').value);
    const jm = parseInt(document.getElementById('pers-in-month').value);
    const jd = parseInt(document.getElementById('pers-in-day').value);
    if (!jy || !jm || !jd) return;
    const maxD = jalaliMonthLen(jy, jm);
    if (jd < 1 || jd > maxD) { alert('Day out of range (1â€“' + maxD + ')'); return; }
    jdn = j2d(jy, jm, jd);
  } else {
    const iy = parseInt(document.getElementById('hijri-in-year').value);
    const im = parseInt(document.getElementById('hijri-in-month').value);
    const id = parseInt(document.getElementById('hijri-in-day').value);
    if (!iy || !im || !id) return;
    const maxD = islamicMonthLen(iy, im);
    if (id < 1 || id > maxD) { alert('Day out of range (1â€“' + maxD + ')'); return; }
    jdn = i2d(iy, im, id);
  }
  currentJDN = jdn;
  syncViewFromJDN(jdn);
  renderAll();
}

function goToToday() {
  currentJDN = todayJDN;
  syncViewFromJDN(currentJDN);
  renderAll();
}

// ============================================================
// POPULATE MONTH SELECTS
// ============================================================
function populateMonthSelects() {
  const gs = document.getElementById('greg-in-month');
  GREG_MONTHS.forEach((n, i) => {
    const o = document.createElement('option'); o.value = i + 1; o.textContent = n; gs.appendChild(o);
  });
  const ps = document.getElementById('pers-in-month');
  PERS_MONTHS.forEach((n, i) => {
    const o = document.createElement('option'); o.value = i + 1; o.textContent = n; ps.appendChild(o);
  });
  const hs = document.getElementById('hijri-in-month');
  HIJRI_MONTHS.forEach((n, i) => {
    const o = document.createElement('option'); o.value = i + 1; o.textContent = n; hs.appendChild(o);
  });
}

// ============================================================
// RENDER ALL
// ============================================================
function renderAll() {
  renderGregorian();
  renderPersian();
  renderHijri();
  updateInputFields();
}

// ============================================================
// GREGORIAN RENDER
// ============================================================
function renderGregorian() {
  const { y, m } = viewGreg;
  const leap = isLeapGregorian(y);

  document.getElementById('greg-month-name').innerHTML =
    GREG_MONTHS[m - 1] + (leap ? '<span class="leap-badge">Leap</span>' : '');
  document.getElementById('greg-year-num').textContent = y;

  const firstJDN = g2d(y, m, 1);
  const daysInMonth = gregorianMonthLen(y, m);
  // Day of week of 1st: 0=Sun..6=Sat
  const firstDow = mod(firstJDN + 1, 7); // 0=Sun

  // Selected date in this calendar
  const sel = d2g(currentJDN);
  const today = d2g(todayJDN);

  let html = '<thead><tr>';
  GREG_DAYS.forEach(d => { html += '<th>' + d + '</th>'; });
  html += '</tr></thead><tbody><tr>';

  // Empty cells before first day
  for (let i = 0; i < firstDow; i++) html += '<td class="empty"></td>';

  let col = firstDow;
  for (let day = 1; day <= daysInMonth; day++) {
    const jdn = firstJDN + day - 1;
    const dow = mod(jdn + 1, 7);
    let cls = '';
    if (jdn === todayJDN) cls += ' today';
    if (jdn === currentJDN) cls += ' selected';
    if (dow === 0 || dow === 6) cls += ' weekend';
    html += '<td class="' + cls.trim() + '" onclick="selectDay(' + jdn + ')">' + day + '</td>';
    col++;
    if (col % 7 === 0 && day < daysInMonth) html += '</tr><tr>';
  }
  // Fill remaining cells
  const remaining = (7 - (col % 7)) % 7;
  for (let i = 0; i < remaining; i++) html += '<td class="empty"></td>';
  html += '</tr></tbody>';
  document.getElementById('greg-grid').innerHTML = html;
}

// ============================================================
// PERSIAN RENDER
// ============================================================
function renderPersian() {
  const { jy, jm } = viewPers;
  const leap = isLeapJalali(jy);

  document.getElementById('pers-month-name').innerHTML =
    PERS_MONTHS[jm - 1] + (leap ? '<span class="leap-badge">Leap</span>' : '');
  document.getElementById('pers-year-num').textContent = jy;

  const firstJDN = j2d(jy, jm, 1);
  const daysInMonth = jalaliMonthLen(jy, jm);

  // Persian week starts Saturday (dow=6 in Sun=0 system)
  // firstDow in Persian: 0=Sat, 1=Sun, ..., 6=Fri
  const gregDow = mod(firstJDN + 1, 7); // 0=Sun
  const persDow = mod(gregDow + 1, 7);  // 0=Sat

  const sel = d2j(currentJDN);
  const tod = d2j(todayJDN);

  let html = '<thead><tr>';
  PERS_DAYS.forEach(d => { html += '<th>' + d + '</th>'; });
  html += '</tr></thead><tbody><tr>';

  for (let i = 0; i < persDow; i++) html += '<td class="empty"></td>';

  let col = persDow;
  for (let day = 1; day <= daysInMonth; day++) {
    const jdn = firstJDN + day - 1;
    const gregDow2 = mod(jdn + 1, 7);
    const persDow2 = mod(gregDow2 + 1, 7); // 0=Sat, 6=Fri
    let cls = '';
    if (jdn === todayJDN) cls += ' today';
    if (jdn === currentJDN) cls += ' selected';
    // Weekend in Persian calendar: Friday (persDow2=6)
    if (persDow2 === 6) cls += ' weekend';
    html += '<td class="' + cls.trim() + '" onclick="selectDay(' + jdn + ')">' + day + '</td>';
    col++;
    if (col % 7 === 0 && day < daysInMonth) html += '</tr><tr>';
  }
  const remaining = (7 - (col % 7)) % 7;
  for (let i = 0; i < remaining; i++) html += '<td class="empty"></td>';
  html += '</tr></tbody>';
  document.getElementById('pers-grid').innerHTML = html;
}

// ============================================================
// HIJRI RENDER
// ============================================================
function renderHijri() {
  const { iy, im } = viewHijri;
  const leap = isLeapIslamic(iy);

  document.getElementById('hijri-month-name').innerHTML =
    HIJRI_MONTHS[im - 1] + (leap ? '<span class="leap-badge">Leap</span>' : '');
  document.getElementById('hijri-year-num').textContent = iy + ' AH';

  const firstJDN = i2d(iy, im, 1);
  const daysInMonth = islamicMonthLen(iy, im);

  // Hijri week starts Sunday (same as Gregorian)
  const firstDow = mod(firstJDN + 1, 7); // 0=Sun

  let html = '<thead><tr>';
  HIJRI_DAYS.forEach(d => { html += '<th>' + d + '</th>'; });
  html += '</tr></thead><tbody><tr>';

  for (let i = 0; i < firstDow; i++) html += '<td class="empty"></td>';

  let col = firstDow;
  for (let day = 1; day <= daysInMonth; day++) {
    const jdn = firstJDN + day - 1;
    const dow = mod(jdn + 1, 7);
    let cls = '';
    if (jdn === todayJDN) cls += ' today';
    if (jdn === currentJDN) cls += ' selected';
    // Weekend in Islamic calendar: Friday (dow=5) and Saturday (dow=6)
    if (dow === 5 || dow === 6) cls += ' weekend';
    html += '<td class="' + cls.trim() + '" onclick="selectDay(' + jdn + ')">' + day + '</td>';
    col++;
    if (col % 7 === 0 && day < daysInMonth) html += '</tr><tr>';
  }
  const remaining = (7 - (col % 7)) % 7;
  for (let i = 0; i < remaining; i++) html += '<td class="empty"></td>';
  html += '</tr></tbody>';
  document.getElementById('hijri-grid').innerHTML = html;
}

// ============================================================
// SELECT DAY (click on a cell)
// ============================================================
function selectDay(jdn) {
  currentJDN = jdn;
  syncViewFromJDN(jdn);
  renderAll();
}

// ============================================================
// UPDATE INPUT FIELDS to reflect currentJDN
// ============================================================
function updateInputFields() {
  const g = d2g(currentJDN);
  document.getElementById('greg-in-year').value  = g.gy;
  document.getElementById('greg-in-month').value = g.gm;
  document.getElementById('greg-in-day').value   = g.gd;

  const p = d2j(currentJDN);
  document.getElementById('pers-in-year').value  = p.jy;
  document.getElementById('pers-in-month').value = p.jm;
  document.getElementById('pers-in-day').value   = p.jd;

  const h = d2i(currentJDN);
  document.getElementById('hijri-in-year').value  = h.iy;
  document.getElementById('hijri-in-month').value = h.im;
  document.getElementById('hijri-in-day').value   = h.id;
}

// ============================================================
// START
// ============================================================
init();
</script>
</body>
</html>